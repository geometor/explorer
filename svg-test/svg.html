<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEOMETOR Explorer</title>
    <link rel="stylesheet" href="style.css">
    <link id="dark-mode-stylesheet" rel="stylesheet" href="dark.css">
    <style>

        g#points circle.selected {
        }

        /* Hover card styling */
        #hover-card {
            position: absolute;
            display: none;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px 10px;
            font-family: sans-serif;
            font-size: 12px;
            pointer-events: none; /* Prevents the card from interfering with mouse events */
            z-index: 10;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
</head><body class="web">
    <div id="hover-card"></div>
    <main>
        <svg id="drawing" xmlns="http://www.w.org/2000/svg" viewBox="-1.6 -2.1 4.2 4.2" preserveAspectRatio="xMidYMid slice">
        <defs>
            <filter id="glow" x="-250%" y="-250%" width="500%" height="500%">
                <feGaussianBlur stdDeviation="0.01" result="coloredBlur"/>
                <feMerge>
                    <feMergeNode in="coloredBlur"/>
                    <feMergeNode in="SourceGraphic"/>
                </feMerge>
            </filter>
        </defs>
        <line id="[ A B ]" x1="-1.6" x2="2.6" y1="0" y2="0"></line>
        <circle id="( A B )" cx="0" cy="0" r="1"></circle>
        <circle id="( B A )" cx="1" cy="0" r="1"></circle>
        <circle id="( x A )" cx=".5" cy="0" r=".5" ></circle>

        <g id="points">
        <circle id="A" cx="0" cy="0" r=".02"></circle>
        <circle id="B" cx="1" cy="0" r=".02"></circle>
        <circle id="C" cx="-1" cy="0" r=".02"></circle>
        <circle id="D" cx="2" cy="0" r=".02"></circle>
        <circle id="E" cx="0.5" cy="-0.8660254037844386" r=".02"></circle>
        <circle id="G" cx="0.5" cy="0.8660254037844386" r=".02"></circle>
        </g>
    </main>
    <script>
        const svg = document.getElementById('drawing');
        const pointsGroup = document.getElementById('points');
        const hoverCard = document.getElementById('hover-card');
        let selectedPoints = [];

        pointsGroup.addEventListener('click', (event) => {
            const target = event.target;
            if (target.tagName === 'circle') {
                const index = selectedPoints.indexOf(target);
                if (index > -1) {
                    // Point is already selected, so deselect it
                    selectedPoints.splice(index, 1);
                    target.classList.remove('selected');
                    // target.style.filter = '';
                } else {
                    // Point is not selected, so select it
                    selectedPoints.push(target);
                    target.classList.add('selected');
                    // target.style.filter = 'url(#glow)';
                }
            }
        });

        function scaleCircles() {
            const svgRect = svg.getBoundingClientRect();
            if (svgRect.width === 0) return;

            const currentViewBox = svg.getAttribute('viewBox').split(' ').map(Number);
            const viewBoxWidth = currentViewBox[2];
            const unitsPerPixel = viewBoxWidth / svgRect.width;
            const desiredRadiusPixels = 5; 
            const newRadius = desiredRadiusPixels * unitsPerPixel;

            const circles = pointsGroup.querySelectorAll('circle');
            circles.forEach(circle => {
                circle.setAttribute('r', newRadius);
            });
        }

        svg.addEventListener('wheel', (event) => {
            event.preventDefault();
            const currentViewBox = svg.getAttribute('viewBox').split(' ').map(Number);
            let [x, y, width, height] = currentViewBox;
            const scaleFactor = event.deltaY > 0 ? 1.1 : 1 / 1.1;
            const { clientX, clientY } = event;
            const svgRect = svg.getBoundingClientRect();
            const svgX = clientX - svgRect.left;
            const svgY = clientY - svgRect.top;
            const mousePoint = {
                x: x + (svgX / svgRect.width) * width,
                y: y + (svgY / svgRect.height) * height
            };
            width *= scaleFactor;
            height *= scaleFactor;
            x = mousePoint.x - (svgX / svgRect.width) * width;
            y = mousePoint.y - (svgY / svgRect.height) * height;
            svg.setAttribute('viewBox', `${x} ${y} ${width} ${height}`);
            scaleCircles();
        });

        let isPanning = false;
        let startPoint = { x: 0, y: 0 };

        svg.addEventListener('mousedown', (event) => {
            isPanning = true;
            startPoint = { x: event.clientX, y: event.clientY };
            svg.style.cursor = 'grabbing';
        });

        svg.addEventListener('mousemove', (event) => {
            if (!isPanning) return;
            const svgRect = svg.getBoundingClientRect();
            const currentViewBox = svg.getAttribute('viewBox').split(' ').map(Number);
            let [x, y, width, height] = currentViewBox;
            const dx = (event.clientX - startPoint.x) * (width / svgRect.width);
            const dy = (event.clientY - startPoint.y) * (height / svgRect.height);
            x -= dx;
            y -= dy;
            svg.setAttribute('viewBox', `${x} ${y} ${width} ${height}`);
            startPoint = { x: event.clientX, y: event.clientY };
        });

        svg.addEventListener('mouseup', () => {
            isPanning = false;
            svg.style.cursor = 'default';
        });

        svg.addEventListener('mouseleave', () => {
            isPanning = false;
            svg.style.cursor = 'default';
        });


        const hoverableElements = svg.querySelectorAll('line, circle, g#points circle');
        hoverableElements.forEach(el => {
            el.addEventListener('mouseover', (event) => {
                if (el.id) {
                    hoverCard.textContent = el.id;
                    hoverCard.style.display = 'block';
                }
            });
            el.addEventListener('mousemove', (event) => {
                hoverCard.style.left = `${event.clientX + 10}px`;
                hoverCard.style.top = `${event.clientY + 10}px`;
            });
            el.addEventListener('mouseout', () => {
                hoverCard.style.display = 'none';
            });
        });

        const resizeObserver = new ResizeObserver(scaleCircles);
        resizeObserver.observe(svg);
        scaleCircles();
    </script>
</body></html>
